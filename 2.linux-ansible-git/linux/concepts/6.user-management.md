# **6. User Management**

### **Definition**

* **User Management** is the process of **creating, modifying, and controlling access** for users in Linux.
* Includes **authentication** (verifying identity) and **authorization** (defining what a user can do).

---

### **1. Authentication vs Authorization**

* **Authentication** → Verifying who the user is.

  * Example: Entering a username and password.
* **Authorization** → Determining what the user can access or do.

  * Example: Read/write permission on files or sudo privileges.

---

### **2. Users, Groups & System Users**

* **User** → Individual account with login credentials.
* **Group** → Collection of users to simplify permission management.
* **System Users** → Special users created by the system (no login, for services).

  * Examples: `root`, `daemon`, `www-data`

**Check users/groups:**

```bash
cat /etc/passwd       # List all users
cat /etc/group        # List all groups
```

---

### **3. Commands for User Management**

#### **Add User**

```bash
sudo useradd username
sudo passwd username       # Set password
```

#### **Modify User**

```bash
sudo usermod -aG groupname username  # Add user to group
sudo usermod -l newname oldname      # Change username
sudo usermod -d /new/home username   # Change home directory
```

#### **Add Group**

```bash
sudo groupadd groupname
```

#### **Delete User**

```bash
sudo userdel username
sudo userdel -r username   # Delete user and home directory
```

---

### **4. Important System Files**

| File          | Purpose                                                                                                                         |
| ------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| `/etc/passwd` | Stores **user account info** (username, UID, GID, home, shell). Password field shows `x` (encrypted password in `/etc/shadow`). |
| `/etc/shadow` | Stores **encrypted passwords**, password expiry info (root-only readable).                                                      |
| `/etc/group`  | Stores **group info** (group name, GID, members).                                                                               |

**Example `/etc/passwd` line:**

```
konka:x:1001:1001:Joshua:/home/konka:/bin/bash
```

* `x` → password stored in `/etc/shadow`
* `1001` → UID, `1001` → GID
* `/home/konka` → home directory
* `/bin/bash` → default shell

---

### **5. Switching Users (`su`, `sudo`)**

#### **`su` (switch user)**

* Switch to another user account.

```bash
su - username       # Switch to username and load environment
su -               # Switch to root
```

#### **`sudo` (superuser do)**

* Run commands as **root or another user** without logging in as that user.

```bash
sudo command        # Run command with root privileges
sudo -i            # Start root shell
sudo -u user cmd   # Run command as a specific user
```

**Difference:**

| Command | Use Case                                     |
| ------- | -------------------------------------------- |
| `su`    | Switch to another user completely            |
| `sudo`  | Run a single command as root or another user |

---

### **6. Quick Examples**

```bash
# Add a user and set password
sudo useradd konka
sudo passwd konka

# Add user to group
sudo groupadd devops
sudo usermod -aG devops konka

# Check groups for user
groups konka

# Run command as root
sudo apt update
```

---

✅ **Summary:**

* Users = accounts; Groups = collection of users
* Authentication = verify identity; Authorization = control access
* Important files = `/etc/passwd`, `/etc/shadow`, `/etc/group`
* Commands = `useradd`, `usermod`, `passwd`, `groupadd`, `su`, `sudo`

---

# **User Management Commands & Examples**

### **1. Add a User**

```bash
sudo useradd konka         # Create a new user 'konka'
sudo passwd konka          # Set password for 'konka'
```

**Optional:** Create home directory explicitly:

```bash
sudo useradd -m konka      # Creates /home/konka automatically
```

---

### **2. Modify a User**

```bash
sudo usermod -l joshua konka       # Change username from konka → joshua
sudo usermod -d /home/joshua joshua # Change home directory
sudo usermod -aG sudo joshua       # Add user to 'sudo' group
```

---

### **3. Delete a User**

```bash
sudo userdel joshua             # Delete user account
sudo userdel -r joshua          # Delete user and home directory
```

---

### **4. Add a Group**

```bash
sudo groupadd devops           # Create group 'devops'
sudo usermod -aG devops joshua # Add user to 'devops' group
```

---

### **5. List Users & Groups**

```bash
cat /etc/passwd     # List all users
cat /etc/group      # List all groups
groups joshua       # Show groups of a specific user
id joshua           # Show UID, GID, and group memberships
```

---

### **6. Change Password**

```bash
sudo passwd joshua    # Change password for user
passwd                # Change password for current user
```

---

### **7. Switch Users**

```bash
su - joshua           # Switch to user 'joshua' and load environment
su -                  # Switch to root user
sudo -i               # Start root shell
sudo -u joshua command # Run command as another user
```

---

### **8. Lock/Unlock User Account**

```bash
sudo usermod -L joshua   # Lock user account
sudo usermod -U joshua   # Unlock user account
```

---

### **9. Expire User Password**

```bash
sudo chage -E 2025-12-31 joshua   # Set account expiry date
sudo chage -l joshua              # View password expiry info
```

---

### **10. Practical Example Workflow**

```bash
# Create user and group
sudo groupadd devops
sudo useradd -m -G devops konka
sudo passwd konka

# Check user info
id konka
groups konka

# Allow user to run specific command with sudo
sudo visudo
# Add: konka ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart nginx
```

---

# **/etc/sudoers & sudo visudo**

### **1. What is `/etc/sudoers`?**

* `/etc/sudoers` is the **configuration file** that defines **which users or groups can run commands with `sudo`**.
* It also defines **how sudo behaves**, such as requiring passwords, logging commands, and limiting commands.

**Key Points:**

* Only **root** should edit this file directly.
* Mistakes can lock you out of `sudo`.
* That’s why we use `sudo visudo` to edit it safely.

---

### **2. What is `sudo visudo`?**

* `visudo` is a **safe editor** for `/etc/sudoers`.
* Checks **syntax** before saving, preventing mistakes that could break sudo access.
* Typically uses **vi/vim** as default editor (can change to nano).

**Example to open sudoers safely:**

```bash
sudo visudo
```

---

### **3. Example Entries in `/etc/sudoers`**

#### **Allow a user to run all commands as root**

```
konka ALL=(ALL:ALL) ALL
```

* `konka` → username
* `ALL` (host) → applies on all machines
* `(ALL:ALL)` → can run commands as any user/group
* Last `ALL` → can run any command

#### **Allow a group to run commands as root**

```
%devops ALL=(ALL) ALL
```

* `%devops` → all users in group `devops`
* Can run any command with sudo

#### **Run specific commands without password**

```
konka ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart nginx
```

* User `konka` can restart nginx **without typing password**
* Only this command is allowed, not all commands

---

### **4. Practical Examples**

```bash
# Run apt update as root
sudo apt update

# Restart nginx (if allowed in sudoers)
sudo systemctl restart nginx

# Edit sudoers safely
sudo visudo
# Add: konka ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart nginx
```

---

### **5. Why we use it**

1. **Control access** → Not everyone should run all root commands.
2. **Audit & logging** → All sudo commands are logged.
3. **Security** → Users get **temporary root privileges** only when needed.
4. **Granular permissions** → Can allow only specific commands for certain users/groups.

---

✅ **Tip:** Always use `sudo visudo` instead of editing `/etc/sudoers` directly to prevent syntax errors.

---

# **More Examples for `/etc/sudoers`**

### **1. Allow a user to run **all commands as any user**

```
konka ALL=(ALL:ALL) ALL
```

* Full root privileges
* Common for sysadmins

---

### **2. Allow a group to run **all commands**

```
%devops ALL=(ALL) ALL
```

* All members of `devops` can use sudo for any command

---

### **3. Allow a user to run **specific commands only**

```
konka ALL=(ALL) /usr/bin/systemctl restart nginx, /usr/bin/journalctl -xe
```

* User can **restart nginx** and view logs
* Cannot run other root commands

---

### **4. Allow a user to run commands **without a password**

```
konka ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart nginx
```

* User doesn’t need to type password for this command
* Useful for automation scripts

---

### **5. Allow a user to run commands as another user**

```
konka ALL=(postgres) /usr/bin/psql
```

* `konka` can run `psql` as `postgres` user
* Cannot run as root or other users

---

### **6. Disable sudo for a specific command**

```
konka ALL=(ALL) ALL, !/bin/rm
```

* User can run all commands **except `rm`**
* Useful for limiting destructive commands

---

### **7. Include another sudoers file**

```
# Include all files in /etc/sudoers.d/
# Each file can contain user-specific rules
@include /etc/sudoers.d
```

* Helps organize sudo permissions
* Avoid editing main `/etc/sudoers` frequently

---

### **Practical Command Usage**

```bash
# Restart nginx (allowed user)
sudo systemctl restart nginx

# View logs (allowed user)
sudo journalctl -xe

# Run command as another user
sudo -u postgres psql
```

---

✅ **Key Points:**

* Always use `sudo visudo` to edit.
* Limit commands for security.
* Can combine multiple rules: allow some commands, block others.

---
