# User Management

### **0. Authentication vs Authorization**

* **Authentication** → Verifying who the user is.

  * Example: Entering a username and password.
* **Authorization** → Determining what the user can access or do.

  * Example: Read/write permission on files or sudo privileges.

## **1. What is User Management?**

* User management in Linux means **creating, modifying, deleting users and groups**, controlling **permissions**, and defining **who can log in and what they can do**.
* Ensures **security** and **resource control**.

---

## **2. Types of Users**

1. **Root User**

   * UID = 0
   * Full control of system

2. **System Users**

   * UID < 1000 (default)
   * Created automatically for services (e.g., `nginx`, `mysql`, `apache`)
   * Usually set to `/sbin/nologin` to prevent login

3. **Normal Users**

   * UID ≥ 1000
   * Created for human users
   * Can log in and perform tasks

---

## **3. User Account Files**

| File              | Description                                                        |
| ----------------- | ------------------------------------------------------------------ |
| `/etc/passwd`     | User account info (username, UID, GID, home dir, shell)            |
| `/etc/shadow`     | Encrypted passwords + password policies                            |
| `/etc/group`      | Group information                                                  |
| `/etc/gshadow`    | Secure group info (passwords)                                      |
| `/etc/login.defs` | Default settings for new users (UID ranges, umask, password aging) |
| `/etc/skel/`      | Default files copied to new home directory                         |

Example from `/etc/passwd`:

```
konka:x:1001:1001:Konka User:/home/konka:/bin/bash
```

* Username = konka
* UID = 1001
* GID = 1001
* Home = /home/konka
* Shell = /bin/bash

---

## **4. User Commands**

```bash
useradd username          # Add new user
adduser username          # Debian/Ubuntu friendly version
passwd username           # Set/change password
usermod -aG group user    # Add user to group
usermod -s /bin/bash user # Change shell
usermod -L username       # Lock account
usermod -U username       # Unlock account
userdel username          # Delete user
userdel -r username       # Delete user + home directory
```

---

## **5. Group Commands**

```bash
groupadd devops          # Create group
groupdel devops          # Delete group
gpasswd -a konka devops  # Add user to group
gpasswd -d konka devops  # Remove user from group
id konka                 # Show UID, GID, groups
groups konka             # Show all groups user belongs to
```

---

## **6. su vs sudo**

* **su** → Switch to another user. Needs target user’s password.
* **su -** → Switch user with full login environment.
* **sudo** → Run single command as root. Needs your password. Safer.
* **visudo** → Safely edit `/etc/sudoers`.

Examples:

```bash
su                    # Switch to root
su -                  # Root with login shell
su siva               # Switch to user siva
su - siva             # Full login as siva
sudo ls /root         # Run command as root
sudo visudo           # Edit sudoers safely
```

---

## **7. /etc/sudoers**

Defines **user privileges**.

### Examples:

```sudoers
# Full access for user
konka ALL=(ALL) ALL

# Specific command
joshua ALL=(ALL) /bin/systemctl restart nginx

# No password required
deploy ALL=(ALL) NOPASSWD: /usr/bin/git, /usr/bin/docker

# Group-level access
%devops ALL=(ALL) ALL

# Deny dangerous command
konka ALL=(ALL) ALL, !/bin/rm

# Run command as specific user
tester ALL=(siva) /usr/bin/tail -f /var/log/app.log
```

---

## **8. Login vs Nologin**

* **Login shell (/bin/bash, /bin/sh)** → User can log in.
* **Nologin shell (/sbin/nologin)** → Blocks login, used for service/system accounts.

Example:

```
apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin
```

---

## **9. Password & Security Management**

* File: `/etc/shadow`
* Format:

```
username:encrypted_password:last_change:min:max:warn:inactive:expire:
```

* Tools:

```bash
passwd user        # Change password
chage -l user      # Show password aging info
chage -M 30 user   # Set max password age to 30 days
```

---

## **10. umask (Default Permissions)**

* **umask** defines default file/directory permissions.
* Normal user default: `0022` → Files = 644, Dirs = 755
* Root default: `0022` → More restrictive for security

---

## **11. Checking Users & Logins**

```bash
whoami              # Current user
id                  # Show UID, GID, groups
who                 # Logged-in users
w                   # Logged-in users + activity
last                # Login history
```