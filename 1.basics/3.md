## **3. NAT Variants**

### **NAT (Network Address Translation)**

* **Translates IP addresses** between private and public networks.
* Allows multiple private devices to share one public IP.
* Used in routers, firewalls, AWS NAT Gateway, etc.

---

### **SNAT (Source NAT)**

* Changes the **source IP address** in packets.
* Example: A private server `10.0.0.5` goes to the internet; router replaces source with its public IP `52.x.x.x`.
* Used for **outbound traffic**.

---

### **DNAT (Destination NAT)**

* Changes the **destination IP address** in packets.
* Example: External user hits public IP `52.x.x.x`; router translates it to internal server `10.0.0.5`.
* Used for **inbound traffic / port forwarding**.

---

### **PNAT (Port Address Translation)** (a.k.a. PAT)

* Translates **both IP address and port numbers**.
* Multiple private hosts share one public IP with different port mappings.
* Example:

  * `10.0.0.5:1234` → `52.x.x.x:5001`
  * `10.0.0.6:5678` → `52.x.x.x:5002`

---

### **Quick Table**

| Variant  | Changes                  | Typical Use               |
| -------- | ------------------------ | ------------------------- |
| **NAT**  | IP translation (generic) | Connect private to public |
| **SNAT** | Source IP                | Outbound traffic          |
| **DNAT** | Destination IP           | Inbound / port forwarding |
| **PNAT** | IP + Port                | Many-to-one IP mapping    |

---

| Step | Source IP                               | Destination IP                                            | Action / Notes                                                                                                                                                       |
| ---- | --------------------------------------- | --------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | 10.10.1.24 (private instance)           | [www.google.com](http://www.google.com) → 143.144.145.146 | DNS resolution happens first via Route53 / VPC resolver.                                                                                                             |
| 2    | 10.10.1.24                              | 143.144.145.146                                           | Packet leaves private subnet and reaches NAT Gateway in public subnet.                                                                                               |
| 3    | 10.10.1.24 → NAT IP (e.g., 52.23.45.67) | 143.144.145.146                                           | **Source NAT happens:** NAT gateway replaces private source IP with its public IP. NAT table keeps track: `10.10.1.24 ↔ 52.23.45.67`. Destination remains Google IP. |
| 4    | 52.23.45.67                             | 143.144.145.146                                           | Packet goes out to the Internet, reaches Google.                                                                                                                     |
| 5    | 143.144.145.146                         | 52.23.45.67                                               | Google responds to the NAT’s public IP (not private).                                                                                                                |
| 6    | 52.23.45.67 → 10.10.1.24                | 143.144.145.146                                           | NAT translates the destination IP from its public IP back to the original private IP. Packet is sent back to the private instance.                                   |
| 7    | 10.10.1.24                              | 143.144.145.146                                           | Private instance receives the response. Ping is successful.                                                                                                          |

**Key points:**

1. NAT only modifies the **source IP** of outgoing packets; the destination IP stays the same.
2. NAT maintains a **translation table** so it knows which response belongs to which private instance.
3. From Google’s perspective, the request comes from the NAT gateway’s public IP. The private IP is never exposed to the Internet.

Exactly! When multiple private instances use the **same NAT Gateway**, the NAT maintains a **translation table** for each session. Let me explain clearly.

Suppose we have:

* Private instances:

  * `10.10.1.24`
  * `10.10.1.25`
* NAT Gateway public IP: `52.23.45.67`

Here’s how NAT handles multiple sessions:

| Private IP | Private Port | NAT IP (Public) | NAT Port (Mapped) | Destination IP  | Notes                                     |
| ---------- | ------------ | --------------- | ----------------- | --------------- | ----------------------------------------- |
| 10.10.1.24 | 50000        | 52.23.45.67     | 62000             | 143.144.145.146 | NAT maps source IP+port to public IP+port |
| 10.10.1.25 | 50001        | 52.23.45.67     | 62001             | 143.144.145.146 | Another entry in NAT table                |

**How it works:**

1. Outgoing packets from private instances reach NAT.
2. NAT **changes the source IP** from private → public and may also **change the source port** to avoid collisions.
3. NAT maintains a **translation table** like this:

```
PrivateIP:PrivatePort <--> NATPublicIP:NATPort
```

4. When responses come back, NAT looks up the **port mapping** in the table and sends the packet to the correct private instance.

✅ So multiple private instances can share a single NAT Gateway. NAT handles **port-based translation** to keep sessions separate.

---


| Step | Private Source IP\:Port | NAT Source IP\:Port | Destination IP  | Notes                                                                                            |
| ---- | ----------------------- | ------------------- | --------------- | ------------------------------------------------------------------------------------------------ |
| 1    | 10.10.1.24:50000        | 52.23.45.67:62000   | 143.144.145.146 | Private instance 1 sends packet, NAT replaces private IP with public IP and maps port.           |
| 2    | 10.10.1.25:50001        | 52.23.45.67:62001   | 143.144.145.146 | Private instance 2 sends packet, NAT replaces IP and maps port differently to avoid conflict.    |
| 3    | 10.10.1.24:50000        | 52.23.45.67:62000   | 143.144.145.146 | Google responds to NAT IP\:port for instance 1. NAT uses table to send back to 10.10.1.24:50000. |
| 4    | 10.10.1.25:50001        | 52.23.45.67:62001   | 143.144.145.146 | Google responds to NAT IP\:port for instance 2. NAT sends back to 10.10.1.25:50001.              |

**NAT Table (Translation Table) Example:**

| Private IP | Private Port | NAT Public IP | NAT Port | Destination IP  |
| ---------- | ------------ | ------------- | -------- | --------------- |
| 10.10.1.24 | 50000        | 52.23.45.67   | 62000    | 143.144.145.146 |
| 10.10.1.25 | 50001        | 52.23.45.67   | 62001    | 143.144.145.146 |

**Summary:**

* NAT can handle **multiple private instances** simultaneously.
* It uses **port mapping** to distinguish sessions.
* From the Internet side, all traffic appears to come from **the same NAT public IP**, but NAT knows which private IP to send the response back to.

---

